# v1.0.0 å¼€å‘å¿«é€Ÿå¯åŠ¨æŒ‡å—

## ğŸš€ å‡†å¤‡å¼€å§‹

æ­å–œå®Œæˆ v0.3.0ï¼ç°åœ¨è®©æˆ‘ä»¬å¼€å§‹ v1.0.0 çš„å¼€å‘ã€‚

---

## ğŸ“‹ å¼€å‘å‰æ£€æŸ¥æ¸…å•

### 1. ç¯å¢ƒå‡†å¤‡
- [ ] Rust 1.70+ å·²å®‰è£…
- [ ] Git ä»“åº“çŠ¶æ€å¹²å‡€ï¼ˆ`git status`ï¼‰
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ˆ`cargo test`ï¼‰
- [ ] v0.3.0 æ ‡ç­¾å·²æ¨é€

### 2. åˆ›å»ºå¼€å‘åˆ†æ”¯
```bash
# ä» master åˆ›å»º v1.0.0 å¼€å‘åˆ†æ”¯
git checkout -b feature/v1.0.0-tabs

# æˆ–è€…ä¸ºæ¯ä¸ª Phase åˆ›å»ºç‹¬ç«‹åˆ†æ”¯
git checkout -b feature/multi-tabs       # Phase 1
git checkout -b feature/port-forward    # Phase 2
git checkout -b feature/proxy-support   # Phase 3
git checkout -b feature/plugin-system   # Phase 4
```

### 3. æ›´æ–°ä¾èµ–
åœ¨ `Cargo.toml` ä¸­æ·»åŠ æ–°ä¾èµ–ï¼š
```toml
[dependencies]
# ç°æœ‰ä¾èµ–...

# æ ‡ç­¾é¡µç³»ç»Ÿ
egui_dock = "0.11"          # åœé é¢æ¿å’Œæ ‡ç­¾é¡µ
egui_extras = "0.27"        # é¢å¤– UI ç»„ä»¶

# ç«¯å£è½¬å‘
tokio-socks = "0.5"         # SOCKS5 ä»£ç†

# æ’ä»¶ç³»ç»Ÿï¼ˆæš‚ä¸æ·»åŠ ï¼ŒPhase 4 æ—¶å†åŠ ï¼‰
# libloading = "0.8"        # åŠ¨æ€åº“åŠ è½½
# wasmer = "4.2"            # WebAssembly è¿è¡Œæ—¶
```

---

## ğŸ¯ Phase 1: å¤šæ ‡ç­¾ç³»ç»Ÿ (ç¬¬ 1-2 å‘¨)

### Step 1: åˆ›å»ºåŸºç¡€æ¨¡å—ç»“æ„

```bash
# åˆ›å»ºæ–°æ¨¡å—ç›®å½•
mkdir -p src/tabs
touch src/tabs/mod.rs
touch src/tabs/manager.rs
touch src/tabs/tab.rs
```

### Step 2: å®ç° Tab æ•°æ®ç»“æ„

ç¼–è¾‘ `src/tabs/tab.rs`:
```rust
use std::time::SystemTime;

pub struct Tab {
    pub id: usize,
    pub title: String,
    pub connection_id: Option<usize>,
    pub created_at: SystemTime,
    pub last_active: SystemTime,
}

impl Tab {
    pub fn new(id: usize, title: String) -> Self {
        Self {
            id,
            title,
            connection_id: None,
            created_at: SystemTime::now(),
            last_active: SystemTime::now(),
        }
    }
    
    pub fn mark_active(&mut self) {
        self.last_active = SystemTime::now();
    }
}

#[cfg(test)]
mod tests {
    use super::*;
    
    #[test]
    fn test_tab_creation() {
        let tab = Tab::new(1, "Test Tab".to_string());
        assert_eq!(tab.id, 1);
        assert_eq!(tab.title, "Test Tab");
    }
}
```

### Step 3: å®ç° TabManager

ç¼–è¾‘ `src/tabs/manager.rs`:
```rust
use super::tab::Tab;

pub struct TabManager {
    pub tabs: Vec<Tab>,
    pub active_tab_index: usize,
    next_tab_id: usize,
}

impl TabManager {
    pub fn new() -> Self {
        let mut manager = Self {
            tabs: Vec::new(),
            active_tab_index: 0,
            next_tab_id: 1,
        };
        
        // åˆ›å»ºé»˜è®¤æ ‡ç­¾
        manager.create_tab("Tab 1".to_string());
        manager
    }
    
    pub fn create_tab(&mut self, title: String) -> usize {
        let tab_id = self.next_tab_id;
        self.next_tab_id += 1;
        
        let tab = Tab::new(tab_id, title);
        self.tabs.push(tab);
        self.active_tab_index = self.tabs.len() - 1;
        
        tab_id
    }
    
    pub fn close_tab(&mut self, index: usize) -> bool {
        if self.tabs.len() <= 1 || index >= self.tabs.len() {
            return false;
        }
        
        self.tabs.remove(index);
        
        if self.active_tab_index >= self.tabs.len() {
            self.active_tab_index = self.tabs.len() - 1;
        }
        
        true
    }
    
    pub fn active_tab(&self) -> Option<&Tab> {
        self.tabs.get(self.active_tab_index)
    }
    
    pub fn active_tab_mut(&mut self) -> Option<&mut Tab> {
        self.tabs.get_mut(self.active_tab_index)
    }
}

#[cfg(test)]
mod tests {
    use super::*;
    
    #[test]
    fn test_create_tab() {
        let mut manager = TabManager::new();
        assert_eq!(manager.tabs.len(), 1);
        
        manager.create_tab("Test".to_string());
        assert_eq!(manager.tabs.len(), 2);
    }
    
    #[test]
    fn test_close_tab() {
        let mut manager = TabManager::new();
        manager.create_tab("Tab 2".to_string());
        
        assert!(manager.close_tab(1));
        assert_eq!(manager.tabs.len(), 1);
    }
}
```

### Step 4: å¯¼å‡ºæ¨¡å—

ç¼–è¾‘ `src/tabs/mod.rs`:
```rust
pub mod manager;
pub mod tab;

pub use manager::TabManager;
pub use tab::Tab;
```

### Step 5: é›†æˆåˆ°ä¸»ç¨‹åº

ç¼–è¾‘ `src/lib.rs`:
```rust
pub mod tabs;  // æ·»åŠ è¿™ä¸€è¡Œ
```

ç¼–è¾‘ `src/state/mod.rs`ï¼Œæ·»åŠ  TabManager:
```rust
use crate::tabs::TabManager;

pub struct AppState {
    // ... ç°æœ‰å­—æ®µ
    
    // æ–°å¢æ ‡ç­¾ç®¡ç†å™¨
    pub tab_manager: TabManager,
}
```

### Step 6: è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ–°æ¨¡å—çš„æµ‹è¯•
cargo test tabs::

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
cargo test

# æ„å»ºæ£€æŸ¥
cargo build
```

### Step 7: æäº¤è¿›åº¦

```bash
git add src/tabs/
git commit -m "feat(tabs): Add basic Tab and TabManager structures

- Implement Tab data structure with id, title, timestamps
- Implement TabManager for creating/closing/switching tabs
- Add unit tests for tab operations
- Integrate TabManager into AppState

Part of Phase 1 for v1.0.0"
```

---

## ğŸ“ å¼€å‘æµç¨‹å»ºè®®

### æ¯æ—¥å·¥ä½œæµ

#### 1. å¼€å§‹å¼€å‘
```bash
# æ‹‰å–æœ€æ–°ä»£ç 
git pull origin master

# åˆ‡æ¢åˆ°åŠŸèƒ½åˆ†æ”¯
git checkout feature/multi-tabs

# è¿è¡Œæµ‹è¯•ç¡®ä¿åŸºçº¿æ­£å¸¸
cargo test
```

#### 2. å¼€å‘åŠŸèƒ½
- å‚è€ƒ `v1.0.0_technical_design.md` ä¸­çš„å®ç°ç»†èŠ‚
- éµå¾ª TDDï¼ˆæµ‹è¯•é©±åŠ¨å¼€å‘ï¼‰ï¼šå…ˆå†™æµ‹è¯•ï¼Œå†å†™å®ç°
- æ¯å®Œæˆä¸€ä¸ªå°åŠŸèƒ½å°±è¿è¡Œæµ‹è¯•

#### 3. æäº¤ä»£ç 
```bash
# æŸ¥çœ‹æ”¹åŠ¨
git status
git diff

# æ·»åŠ æ–‡ä»¶
git add src/tabs/

# æäº¤
git commit -m "feat(tabs): <å…·ä½“åŠŸèƒ½æè¿°>"

# å®šæœŸæ¨é€
git push origin feature/multi-tabs
```

#### 4. åˆå¹¶åˆ°ä¸»åˆ†æ”¯
```bash
# åˆ‡æ¢åˆ° master
git checkout master

# åˆå¹¶åŠŸèƒ½åˆ†æ”¯
git merge feature/multi-tabs

# æ¨é€åˆ°è¿œç¨‹
git push origin master
```

### Commit æ¶ˆæ¯è§„èŒƒ

```
ç±»å‹(èŒƒå›´): ç®€çŸ­æè¿°

è¯¦ç»†æè¿°ï¼ˆå¯é€‰ï¼‰

Breaking Changesï¼ˆå¦‚æœæœ‰ï¼‰
```

**ç±»å‹**:
- `feat`: æ–°åŠŸèƒ½
- `fix`: Bug ä¿®å¤
- `docs`: æ–‡æ¡£æ›´æ–°
- `test`: æµ‹è¯•ç›¸å…³
- `refactor`: ä»£ç é‡æ„
- `perf`: æ€§èƒ½ä¼˜åŒ–
- `chore`: æ„å»º/å·¥å…·ç›¸å…³

**èŒƒå›´**:
- `tabs`: æ ‡ç­¾é¡µç³»ç»Ÿ
- `port-forward`: ç«¯å£è½¬å‘
- `proxy`: SSH ä»£ç†
- `plugin`: æ’ä»¶ç³»ç»Ÿ

**ç¤ºä¾‹**:
```bash
git commit -m "feat(tabs): Add keyboard shortcuts for tab navigation

- Ctrl+T: Create new tab
- Ctrl+W: Close current tab
- Ctrl+Tab: Next tab
- Ctrl+Shift+Tab: Previous tab

Implements keyboard navigation for multi-tab system"
```

---

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### å•å…ƒæµ‹è¯•
æ¯ä¸ªæ–°å‡½æ•°/ç»“æ„éƒ½åº”è¯¥æœ‰æµ‹è¯•ï¼š

```rust
#[cfg(test)]
mod tests {
    use super::*;
    
    #[test]
    fn test_feature_name() {
        // Arrange
        let mut manager = TabManager::new();
        
        // Act
        let result = manager.create_tab("Test".to_string());
        
        // Assert
        assert_eq!(result, 1);
    }
}
```

### è¿è¡Œæµ‹è¯•
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
cargo test

# è¿è¡Œç‰¹å®šæ¨¡å—æµ‹è¯•
cargo test tabs::

# è¿è¡Œå¹¶æ˜¾ç¤ºè¾“å‡º
cargo test -- --nocapture

# è¿è¡Œå•ä¸ªæµ‹è¯•
cargo test test_create_tab
```

### é›†æˆæµ‹è¯•
åœ¨ `tests/` ç›®å½•åˆ›å»ºé›†æˆæµ‹è¯•ï¼š

```rust
// tests/tab_integration.rs
use ishell::tabs::TabManager;

#[test]
fn test_multi_tab_workflow() {
    let mut manager = TabManager::new();
    
    // åˆ›å»ºå¤šä¸ªæ ‡ç­¾
    manager.create_tab("Tab 2".to_string());
    manager.create_tab("Tab 3".to_string());
    
    assert_eq!(manager.tabs.len(), 3);
    
    // å…³é—­æ ‡ç­¾
    assert!(manager.close_tab(1));
    assert_eq!(manager.tabs.len(), 2);
}
```

---

## ğŸ¨ UI å¼€å‘æç¤º

### ä½¿ç”¨ egui_dockï¼ˆå¯é€‰ï¼‰
å¦‚æœå†³å®šä½¿ç”¨ `egui_dock` åº“ï¼š

```rust
use egui_dock::{DockArea, DockState, Style, TabViewer};

struct MyTabViewer {
    tab_manager: TabManager,
}

impl TabViewer for MyTabViewer {
    type Tab = Tab;
    
    fn title(&mut self, tab: &mut Self::Tab) -> egui::WidgetText {
        (&tab.title).into()
    }
    
    fn ui(&mut self, ui: &mut egui::Ui, tab: &mut Self::Tab) {
        ui.label(&tab.title);
        // æ¸²æŸ“æ ‡ç­¾å†…å®¹
    }
}
```

### æ‰‹åŠ¨å®ç°æ ‡ç­¾æ 
```rust
fn render_tab_bar(tab_manager: &mut TabManager, ui: &mut egui::Ui) {
    ui.horizontal(|ui| {
        for (index, tab) in tab_manager.tabs.iter().enumerate() {
            let is_active = index == tab_manager.active_tab_index;
            
            if ui.selectable_label(is_active, &tab.title).clicked() {
                tab_manager.active_tab_index = index;
            }
        }
        
        if ui.button("â•").clicked() {
            tab_manager.create_tab(format!("Tab {}", tab_manager.next_tab_id));
        }
    });
}
```

---

## ğŸ“Š è¿›åº¦è¿½è¸ª

### Phase 1 æ£€æŸ¥æ¸…å•

#### Week 1
- [ ] Tab å’Œ TabManager åŸºç¡€ç»“æ„
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–
- [ ] é›†æˆåˆ° AppState
- [ ] åŸºç¡€ UI æ¸²æŸ“ï¼ˆæ ‡ç­¾æ ï¼‰
- [ ] åˆ›å»º/å…³é—­æ ‡ç­¾åŠŸèƒ½

#### Week 2
- [ ] æ ‡ç­¾åˆ‡æ¢é€»è¾‘
- [ ] é”®ç›˜å¿«æ·é”®
- [ ] å³é”®èœå•
- [ ] æ ‡ç­¾çŠ¶æ€éš”ç¦»
- [ ] æ€§èƒ½æµ‹è¯•
- [ ] æ–‡æ¡£æ›´æ–°

### ä½¿ç”¨ GitHub Issues/Projects
åˆ›å»ºä»»åŠ¡è¿½è¸ªï¼š

```bash
# åœ¨ GitHub ä¸Šåˆ›å»ºé‡Œç¨‹ç¢‘
v1.0.0-beta.1
v1.0.0-rc.1
v1.0.0

# åˆ›å»º Issues
- [ ] Implement Tab data structure
- [ ] Implement TabManager
- [ ] Add tab UI
- [ ] Add keyboard shortcuts
- [ ] Write tests
```

---

## ğŸ› è°ƒè¯•æŠ€å·§

### 1. ä½¿ç”¨æ—¥å¿—
```rust
// æ·»åŠ ä¾èµ–
// env_logger = "0.11"

// åœ¨ä»£ç ä¸­ä½¿ç”¨
use log::{debug, info, warn, error};

debug!("Tab created: id={}", tab_id);
info!("Active tab changed to {}", index);
```

### 2. egui è°ƒè¯•å·¥å…·
```rust
// åœ¨ UI ä¸­æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯
ui.label(format!("Active tab: {}", tab_manager.active_tab_index));
ui.label(format!("Total tabs: {}", tab_manager.tabs.len()));

// ä½¿ç”¨ egui å†…ç½®è°ƒè¯•é¢æ¿
ctx.set_debug_on_hover(true);
```

### 3. æ€§èƒ½åˆ†æ
```bash
# ä½¿ç”¨ flamegraph
cargo install flamegraph
sudo cargo flamegraph

# ä½¿ç”¨ criterion åŸºå‡†æµ‹è¯•
cargo bench
```

---

## ğŸ“š å‚è€ƒèµ„æº

### å®˜æ–¹æ–‡æ¡£
- [egui Documentation](https://docs.rs/egui/)
- [ssh2 Documentation](https://docs.rs/ssh2/)
- [tokio Documentation](https://docs.rs/tokio/)

### ç¤ºä¾‹é¡¹ç›®
- [egui Demo](https://github.com/emilk/egui/tree/master/crates/egui_demo_app)
- [libloading Examples](https://github.com/nagisa/rust_libloading/tree/master/examples)

### Rust æœ€ä½³å®è·µ
- [Rust API Guidelines](https://rust-lang.github.io/api-guidelines/)
- [The Rust Performance Book](https://nnethercote.github.io/perf-book/)

---

## ğŸ’¡ å¸¸è§é—®é¢˜

### Q: å¦‚ä½•å¤„ç†æ ‡ç­¾é¡µä¹‹é—´çš„çŠ¶æ€éš”ç¦»ï¼Ÿ
A: æ¯ä¸ª Tab åŒ…å«è‡ªå·±çš„ `TabState`ï¼ŒåŒ…æ‹¬ç‹¬ç«‹çš„ SSH ä¼šè¯ã€ç»ˆç«¯è¾“å‡ºç­‰ã€‚

### Q: æ˜¯å¦éœ€è¦ä¿å­˜æ ‡ç­¾é¡µçŠ¶æ€ï¼Ÿ
A: å¯ä»¥è€ƒè™‘å°†æ‰“å¼€çš„æ ‡ç­¾é¡µä¿¡æ¯ä¿å­˜åˆ°é…ç½®æ–‡ä»¶ï¼Œå®ç°ä¼šè¯æ¢å¤ã€‚

### Q: å¦‚ä½•é™åˆ¶æ ‡ç­¾é¡µæ•°é‡ï¼Ÿ
A: åœ¨ `TabManager` ä¸­è®¾ç½® `max_tabs` å¸¸é‡ï¼Œåˆ›å»ºæ—¶æ£€æŸ¥ã€‚

### Q: å¦‚ä½•å®ç°æ ‡ç­¾é¡µæ‹–æ”¾é‡æ’åºï¼Ÿ
A: å¯ä»¥ä½¿ç”¨ `egui_dock` åº“ï¼Œæˆ–æ‰‹åŠ¨å¤„ç†æ‹–æ”¾äº‹ä»¶ã€‚

---

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³å¼€å§‹
1. âœ… åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
2. âœ… å®ç° Tab ç»“æ„
3. âœ… å®ç° TabManager
4. âœ… ç¼–å†™æµ‹è¯•
5. âœ… æäº¤ä»£ç 

### æœ¬å‘¨ç›®æ ‡
- å®Œæˆ Tab å’Œ TabManager åŸºç¡€å®ç°
- é›†æˆåˆ° AppState
- æ·»åŠ åŸºç¡€ UI
- æµ‹è¯•è¦†ç›–ç‡è¾¾åˆ° 80%

### ä¸‹å‘¨ç›®æ ‡
- å®ç°é”®ç›˜å¿«æ·é”®
- æ·»åŠ å³é”®èœå•
- å®ç°çŠ¶æ€éš”ç¦»
- æ€§èƒ½ä¼˜åŒ–

---

**å‡†å¤‡å¥½äº†å—ï¼Ÿ** 

è¿è¡Œè¿™ä¸ªå‘½ä»¤å¼€å§‹ï¼š

```bash
# åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
git checkout -b feature/multi-tabs

# åˆ›å»ºæ¨¡å—ç»“æ„
mkdir -p src/tabs
touch src/tabs/{mod.rs,manager.rs,tab.rs}

# å¼€å§‹ç¼–ç ï¼
code src/tabs/tab.rs
```

**ç¥å¼€å‘é¡ºåˆ©ï¼** ğŸš€

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**åˆ›å»ºæ—¥æœŸ**: 2026-02-03  
**é€‚ç”¨ç‰ˆæœ¬**: v1.0.0 Phase 1
